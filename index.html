<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  margin:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
img {
  width:100%;
  max-width:700px;
}
.controls {
  position:fixed;
  bottom:20px;
}
button {
  font-size:18px;
  margin:5px;
}
</style>
</head>

<body>

<img id="radar">

<div class="controls">
  <button onclick="dir*=-1">Reverse</button>
  <button onclick="speed+=100">Slower</button>
  <button onclick="speed=Math.max(100,speed-100)">Faster</button>
</div>

<script>
const product = "IDR663"; // Brisbane radar

let frames = [];
let index = 0;
let dir = 1;
let speed = 400;

async function loadFrames() {

  // BOM frame list used by official viewer
  const url =
    `https://reg.bom.gov.au/products/${product}.T.loop.json`;

  try {
    const res = await fetch(url);
    const data = await res.json();

    frames = data.images.map(img =>
      `https://reg.bom.gov.au${img}`
    );

  } catch(e) {
    console.log("Frame load failed", e);
  }
}

function animate() {
  if(frames.length){
    document.getElementById("radar").src =
      frames[index];

    index += dir;

    if(index >= frames.length-1 || index <= 0)
      dir *= -1;
  }

  setTimeout(animate, speed);
}

loadFrames();
animate();

// refresh frame list every 5 mins WITHOUT reset
setInterval(loadFrames, 300000);

</script>

</body>
</html>
